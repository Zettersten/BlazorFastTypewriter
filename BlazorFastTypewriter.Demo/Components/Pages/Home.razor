@page "/"
@using BlazorFastTypewriter
@rendermode InteractiveServer

<PageTitle>BlazorFastTypewriter Demo</PageTitle>

<div class="wrapper">
    <h1>Typewriter Blazor Component</h1>
    <div class="demo-section">
        <h2>Interactive Demo</h2>

        <div id="controls">
            <button @onclick="Start" disabled="@(_isRunning)">Start</button>
            <button @onclick="Pause" disabled="@(!_isRunning || _isPaused)">Pause</button>
            <button @onclick="Resume" disabled="@(!_isPaused)">Resume</button>
            <button @onclick="Complete" disabled="@(!_isRunning)">Complete</button>
            <button @onclick="Reset" disabled="@(_isRunning && !_isPaused)">Reset</button>
        </div>

        <Typewriter @ref="_typewriter"
                    Autostart="true"
                    Speed="60"
                    OnStart="HandleStart"
                    OnPause="HandlePause"
                    OnResume="HandleResume"
                    OnComplete="HandleComplete"
                    OnReset="HandleReset"
                    OnProgress="HandleProgress">
            <h3>TypeWriter Blazor Component</h3>
            <p>A high-performance Blazor component for character-by-character text animation with HTML support. Suitable for interactive storytelling, educational tutorials, chat simulations, and dynamic content presentation.</p>

            <h4>Features</h4>
            <ul>
                <li><strong>HTML Support</strong> — Preserves tags including <em>emphasis</em>, <a href="#">links</a>, <code>code</code>, and nested structures</li>
                <li><strong>Bidirectional Text</strong> — Supports LTR and RTL text direction via <code>Dir</code> parameter</li>
                <li><strong>Dynamic Content</strong> — Update content with <code>SetTextAsync()</code> method</li>
                <li><strong>Playback Control</strong> — Methods for start, pause, resume, complete, and reset</li>
                <li><strong>Progress Events</strong> — Dispatches progress events during animation</li>
                <li><strong>Accessibility Features</strong> — ARIA live regions and optional reduced motion support</li>
            </ul>

            <h4>Configuration Parameters</h4>
            <ul>
                <li><code>Speed</code> — Characters per second (default: 100)</li>
                <li><code>MinDuration</code> — Minimum animation duration in ms (default: 50)</li>
                <li><code>MaxDuration</code> — Maximum animation duration in ms (default: 500)</li>
                <li><code>Autostart</code> — Auto-start on load, set to <code>false</code> to disable (default: true)</li>
                <li><code>Dir</code> — Text direction: "ltr" or "rtl" (default: ltr)</li>
                <li><code>RespectMotionPreference</code> — Respect prefers-reduced-motion media query (default: false)</li>
                <li><code>AriaLabel</code> — ARIA label for the container region</li>
            </ul>

            <h4>Blazor API Methods</h4>
            <ul>
                <li><code>StartAsync()</code> — Begin animation from start</li>
                <li><code>Pause()</code> — Pause animation</li>
                <li><code>ResumeAsync()</code> — Resume paused animation</li>
                <li><code>CompleteAsync()</code> — Display all content instantly</li>
                <li><code>ResetAsync()</code> — Clear content and reset state</li>
                <li><code>SetTextAsync(html)</code> — Replace content and reset</li>
            </ul>

            <h4>Events</h4>
            <ul>
                <li><code>OnStart</code> — Fired when animation begins</li>
                <li><code>OnPause</code> — Fired when animation pauses</li>
                <li><code>OnResume</code> — Fired when animation resumes</li>
                <li><code>OnComplete</code> — Fired when animation finishes</li>
                <li><code>OnReset</code> — Fired when component resets</li>
                <li><code>OnProgress</code> — Fired every 10 characters with {Current, Total, Percent}</li>
            </ul>

            <h4>RTL Support</h4>
            <p dir="rtl">يدعم المكوّن <strong>النصوص العربية</strong> مع الحفاظ على الاتجاه الصحيح. يمكن دمج <a href="#">الروابط</a> والنصوص الإنجليزية مثل <code>TypeWriter</code> داخل المحتوى العربي.</p>
            <ul dir="rtl">
                <li>يدعم القوائم النقطية بالاتجاه الصحيح</li>
                <li>يحافظ على <strong>التنسيق</strong> داخل العناصر</li>
                <li>يعمل مع <code>الأكواد</code> والعناصر المضمنة</li>
            </ul>

            <h4>Technical Details</h4>
            <p>Built using Blazor Component Model with modern .NET 10 features. Uses efficient DOM extraction via JavaScript interop for HTML parsing. Optimized for minimal allocations and maximum performance. Works in modern browsers supporting Blazor Server and WebAssembly.</p>
        </Typewriter>

        <div id="progress">@_progressText</div>
    </div>
</div>

@code {
    private Typewriter? _typewriter;
    private bool _isRunning;
    private bool _isPaused;
    private string _progressText = string.Empty;

    private async Task Start()
    {
        if (_typewriter is not null)
        {
            await _typewriter.StartAsync();
        }
    }

    private void Pause()
    {
        _typewriter?.Pause();
    }

    private async Task Resume()
    {
        if (_typewriter is not null)
        {
            await _typewriter.ResumeAsync();
        }
    }

    private async Task Complete()
    {
        if (_typewriter is not null)
        {
            await _typewriter.CompleteAsync();
        }
    }

    private async Task Reset()
    {
        if (_typewriter is not null)
        {
            await _typewriter.ResetAsync();
        }
    }

    private void HandleStart()
    {
        _isRunning = true;
        _isPaused = false;
        StateHasChanged();
    }

    private void HandlePause()
    {
        _isPaused = true;
        StateHasChanged();
    }

    private void HandleResume()
    {
        _isPaused = false;
        StateHasChanged();
    }

    private void HandleComplete()
    {
        _isRunning = false;
        _isPaused = false;
        _progressText = "Animation complete!";
        StateHasChanged();
    }

    private void HandleReset()
    {
        _isRunning = false;
        _isPaused = false;
        _progressText = string.Empty;
        StateHasChanged();
    }

    private void HandleProgress(ProgressEventArgs args)
    {
        _progressText = $"Progress: {args.Percent:F1}% ({args.Current}/{args.Total})";
        StateHasChanged();
    }
}
